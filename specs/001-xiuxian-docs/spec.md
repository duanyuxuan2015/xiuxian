# Feature Specification: 凡人修仙文字游戏

**Feature Branch**: `001-xiuxian-docs`
**Created**: 2026-01-13
**Status**: Draft
**Input**: User description: "根据spec-xiuxian.md生成文档"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 创建角色与基础修炼 (Priority: P1)

玩家作为凡人,通过文字界面创建角色,开始修炼之旅,体验从凡人到炼气期的成长过程。

**Why this priority**: 这是游戏的核心入口,没有角色创建和基础修炼系统,玩家无法开始游戏。P1 完成后即可体验完整的"入门→修炼→积累经验→升级境界层次→突破"循环,构成最小可行产品。

**Independent Test**: 可以通过创建新角色、执行修炼操作、积累经验值升级层次、突破境界来独立验证游戏核心循环可玩。

**Acceptance Scenarios**:

1. **Given** 玩家打开游戏, **When** 输入角色姓名和选择初始五维属性(体质、精神、机缘、悟性、气运), **Then** 系统创建角色并显示初始状态(凡人、基础属性、经验值0、可用加点0)
2. **Given** 玩家处于凡人状态悟性为5, **When** 选择"修炼"操作, **Then** 系统计算修炼基础经验=境界基础值×悟性系数(如境界基础100×悟性系数1.5=150点经验),积累足够经验值后角色晋升至炼气期一层,获得加点点数(如炼气期每层1点)
3. **Given** 玩家获得加点点数, **When** 打开属性界面, **Then** 显示可用点数和五维属性当前值,可手动分配到五维属性
4. **Given** 玩家分配加点到五维属性, **When** 确认加点, **Then** 属性立即提升,可用点数减少,重新计算相关属性值
5. **Given** 玩家处于炼气期一层, **When** 继续修炼积累经验值, **When** 经验值达到升级需求, **Then** 自动晋升至炼气期二层,获得1点加点
6. **Given** 玩家境界提升到更高境界(如筑基期、结丹期), **When** 升级境界层次, **Then** 获得更多加点点数(如筑基期每层2点,结丹期每层3点,境界越高点数越多)
7. **Given** 玩家处于炼气期九层机缘为10, **When** 积累足够经验值并满足突破条件,服用突破丹(+20%基础成功率), **Then** 系统计算突破成功率=(基础成功率50%+丹药加成20%)×机缘系数1.5=105%(按100%计算),尝试晋升筑基期必定成功
8. **Given** 玩家处于炼气期九层机缘为1, **When** 积累足够经验值并满足突破条件,未服用突破丹, **Then** 系统计算突破成功率=(基础成功率50%+丹药加成0%)×机缘系数1.0=50%,尝试晋升筑基期有50%概率成功,失败则消耗部分灵气
9. **Given** 玩家属性不足, **When** 尝试修炼或突破, **Then** 系统提示需要恢复(打坐/服用丹药)

---

### User Story 2 - 打坐恢复系统 (Priority: P2)

当玩家体力、气血、灵力不足时,可以通过打坐快速恢复全部状态,继续游戏进程。

**Why this priority**: 打坐是游戏的核心恢复机制,没有恢复系统玩家无法持续进行探索、修炼和战斗。P2 完成后玩家可以体验"消耗→打坐→恢复→继续行动"的完整循环,是游戏可持续性的基础。

**Independent Test**: 可以通过消耗体力后打坐、等待恢复完成、验证状态恢复来独立验证打坐系统功能完整。

**Acceptance Scenarios**:

1. **Given** 玩家体力不足或气血/灵力受损, **When** 选择"打坐"操作, **Then** 系统显示打坐界面,提示需要打坐的时长(默认60秒)
2. **Given** 玩家开始打坐, **When** 打坐进行中, **Then** 玩家无法进行其他操作(修炼、探索、战斗),系统显示倒计时
3. **Given** 玩家完成60秒打坐, **When** 打坐结束, **Then** 体力恢复至100%、气血恢复至100%、灵力恢复至100%
4. **Given** 玩家学习打坐加速技能(如"冥想法"), **When** 开始打坐, **Then** 打坐时间减少(如技能等级1减少10秒,等级2减少20秒)
5. **Given** 玩家装备打坐加速法宝(如"聚灵珠"), **When** 开始打坐, **Then** 打坐时间减少(如法宝品质越高,减少时间越多,可叠加)
6. **Given** 玩家同时拥有加速技能和法宝, **When** 开始打坐, **Then** 打坐时间按叠加效果计算(最少不低于5秒)

---

### User Story 3 - 探索系统 (Priority: P3)

玩家可以通过探索外界,随机遭遇灵草矿脉、秘境、机缘事件等,获取修炼所需的各类资源。

**Why this priority**: 探索是获取修炼资源的主要途径,增加游戏的随机性和重玩价值。P3 完成后玩家可以体验"探索→遭遇→获取资源"的核心循环。

**Independent Test**: 可以通过执行探索操作、遭遇不同事件、获取资源来独立验证探索系统功能完整。

**Acceptance Scenarios**:

1. **Given** 玩家体力充足, **When** 选择"普通探索"操作, **Then** 消耗5体力,获得基础收益(经验值和灵石),随机触发事件
2. **Given** 玩家选择"深入探索"(高风险高回报), **When** 探索完成, **Then** 消耗15体力,获得更高基础收益,触发高价值事件概率提升
3. **Given** 玩家气运为10(高气运), **When** 进行探索, **Then** 触发TREASURE(宝藏)、ENCOUNTER(奇遇)、INHERITANCE(传承)等有利事件概率提升,触发DANGER(危险)事件概率降低
4. **Given** 玩家气运为1(低气运), **When** 进行探索, **Then** 触发DANGER(危险)事件概率提升,触发有利事件概率降低
5. **Given** 玩家探索时触发TREASURE(宝藏)事件, **When** 发现洞府遗迹, **Then** 获得装备、材料、灵石等宝物
6. **Given** 玩家探索时触发TREASURE(宝藏)事件, **When** 打开宝箱, **Then** 随机获得装备或材料
7. **Given** 玩家探索时触发DANGER(危险)事件, **When** 遭遇强盗袭击, **Then** 进入战斗,胜利后获得战利品,额外消耗战斗体力(普通10/精英20/BOSS 30)
8. **Given** 玩家探索时触发DANGER(危险)事件, **When** 触发陷阱, **Then** 可选择消耗资源解除或直接扣除气血
9. **Given** 玩家探索时触发ENCOUNTER(奇遇)事件, **When** 遇到高人指点, **Then** 获得永久属性提升或临时增益
10. **Given** 玩家探索时触发ENCOUNTER(奇遇)事件, **When** 遇到行脚商人, **Then** 可用灵石购买稀有材料或装备
11. **Given** 玩家探索时触发INHERITANCE(传承)事件, **When** 获得上古传承, **Then** 额外消耗10体力(领悟消耗),学会新功法或技能,获得永久属性提升
12. **Given** 玩家探索时无事发生, **When** 探索完成, **Then** 仅获得基础收益(经验值和灵石)
13. **Given** 玩家体力不足5点, **When** 尝试普通探索, **Then** 系统提示"体力不足,需要5点体力"
14. **Given** 玩家体力不足15点, **When** 尝试深入探索, **Then** 系统提示"体力不足,需要15点体力"

---

### User Story 4 - 战斗系统 (Priority: P4)

玩家在探索中会遭遇妖兽,需要通过战斗系统进行对战,胜利可获得战利品和经验。

**Why this priority**: 战斗是修仙路上的必然挑战,也是获取高级资源的重要途径。P4 完成后玩家可以体验"选择怪物→选择战斗模式→战斗→胜负→收益→挂机"的完整流程。

**Independent Test**: 可以通过选择怪物、选择战斗模式、进行战斗、挂机打怪来独立验证战斗系统功能完整。

**Acceptance Scenarios**:

1. **Given** 玩家进入战斗界面, **When** 显示可挑战的怪物列表, **Then** 显示每个怪物的名称、境界、类型(普通/精英/BOSS)、攻击元素类型、元素抗性、体力消耗、掉落奖励
2. **Given** 玩家选择指定的怪物(如火焰蜥蜴), **When** 确认进入战斗, **Then** 显示战斗模式选择选项(手动战斗/自动战斗/挂机战斗)
3. **Given** 玩家选择手动战斗模式, **When** 战斗开始, **Then** 每个回合显示战斗选项(普通攻击/使用技能/使用物品/逃跑),玩家手动选择行动
4. **Given** 玩家选择自动战斗模式, **When** 战斗开始, **Then** 系统自动选择最优行动(普通攻击或技能,根据怪物抗性和灵气值判断),无需玩家操作
5. **Given** 玩家选择挂机战斗模式, **When** 挂机开始, **Then** 自动选择怪物→进入战斗→自动战斗→战斗结束后自动选择下一个怪物继续战斗
6. **Given** 玩家选择挂机战斗模式, **When** 体力或气血归零, **Then** 挂机自动停止,显示"挂机结束,体力/气血不足"
7. **Given** 玩家选择挂机战斗模式, **When** 挂机进行中, **Then** 玩家可以主动停止挂机,显示挂机统计信息(战斗场次、获得经验、获得奖励)
8. **Given** 玩家进入战斗, **When** 显示怪物信息, **Then** 显示怪物名称、境界、类型、攻击元素类型、元素抗性、体力消耗
9. **Given** 玩家回合开始(手动战斗模式), **When** 显示战斗选项, **Then** 玩家可选择普通攻击/使用技能/使用物品/逃跑,并根据妖兽抗性选择合适的技能元素
10. **Given** 玩家回合开始(自动战斗模式), **When** 系统自动选择行动, **Then** 系统根据怪物抗性和灵气值自动选择最优行动(普通攻击或技能,优先使用克制元素的技能)
11. **Given** 玩家选择普通攻击, **When** 攻击命中, **Then** 系统计算伤害=(攻击力-防御力×0.5)×(1-物理抗性)×暴击伤害率,扣除妖兽生命值
12. **Given** 玩家选择使用火系技能(如火球术), **When** 技能释放成功, **Then** 系统计算伤害=(技能基础伤害+攻击力×技能倍率)×(1-火系抗性)×暴击伤害率,消耗灵气
13. **Given** 妖兽具有50%火系抗性, **When** 玩家使用火系技能攻击, **Then** 伤害减半,系统提示"怪物具有高火系抗性,建议使用其他元素技能"
14. **Given** 玩家对抗火焰蜥蜴(火系抗性50%、物理抗性20%), **When** 选择使用冰系技能(如冰锥术)而非火系技能, **Then** 伤害计算=(技能基础伤害+攻击力×技能倍率)×(1-0%),比使用火系技能(伤害×50%)更有效
15. **Given** 玩家暴击率=基础5%+武器暴击率12%+项链暴击率8%=25%, **When** 攻击触发暴击, **Then** 造成200%伤害(暴击伤害率),系统显示"暴击!"提示
16. **Given** 玩家装备暴击武器(暴击率15%)和暴击项链(暴击率10%), **When** 计算总暴击率, **Then** 总暴击率=基础5%+武器15%+项链10%=30%(武器+项链最高可达30%)
17. **Given** 玩家选择使用物品(如回气丹), **When** 物品使用成功, **Then** 恢复灵气或气血,结束当前回合
18. **Given** 玩家选择逃跑, **When** 根据气运(决定速度)计算逃跑成功率, **Then** 成功则结束战斗(无奖励),失败则继续战斗并进入敌人回合
19. **Given** 敌人回合开始, **When** AI决策完成, **Then** 妖兽根据攻击元素类型自动选择攻击或技能,对玩家造成伤害
20. **Given** 妖兽使用火系攻击, **When** 玩家具有30%火系抗性, **Then** 受到的伤害减少30%,系统显示伤害计算详情
21. **Given** 玩家总火系抗性超过75%, **When** 受到火系攻击, **Then** 抗性按75%计算(上限),系统提示"火系抗性已达上限"
22. **Given** 遭遇普通妖兽, **When** 战斗开始, **Then** 消耗10体力,胜利后获得基础奖励
23. **Given** 遭遇精英妖兽, **When** 战斗开始, **Then** 消耗20体力,胜利后获得额外奖励(更高掉落率)
24. **Given** 遭遇BOSS, **When** 战斗开始, **Then** 消耗30体力,胜利后获得稀有奖励(高品质装备、大量经验)
25. **Given** 妖兽生命值归零, **When** 战斗胜利, **Then** 结算奖励(经验值、掉落物品、战利品),显示伤害统计和暴击次数
26. **Given** 玩家战斗失败(生命值归零), **When** 战斗结束, **Then** 消耗减半体力(普通妖兽5点、精英妖兽10点、BOSS 15点),获得部分奖励或无奖励,系统提示"战斗失败"

---

### User Story 5 - 炼丹系统 (Priority: P5)

玩家可以通过炼丹炉,消耗灵草材料炼制各类丹药,用于辅助修炼、恢复状态、提升突破成功率。

**Why this priority**: 炼丹是修仙体系的核心技能,提供强大的增益手段。P5 完成后玩家可以体验"收集灵草→炼制丹药→服用增益→加速修炼"的策略循环。

**Independent Test**: 可以通过收集灵草、按丹方炼丹、服用丹药验证效果来独立验证炼丹系统功能完整。

**Acceptance Scenarios**:

1. **Given** 玩家拥有炼丹炉和灵草材料, **When** 选择"炼丹"并指定丹方, **Then** 显示所需材料、炼制时间、成功率(基础成功率+境界加成+悟性加成+丹炉品质加成+炼丹等级加成)
2. **Given** 玩家炼丹等级为1级(初级), **When** 尝试炼制丹药, **Then** 只能炼制1-2阶丹药,成功率加成+5%
3. **Given** 玩家炼丹等级为5级, **When** 尝试炼制丹药, **Then** 可炼制1-6阶丹药,成功率加成+25%
4. **Given** 玩家炼丹等级为10级(宗师), **When** 尝试炼制丹药, **Then** 可炼制1-10阶丹药(包括仙丹),成功率加成+50%
5. **Given** 玩家炼制3阶丹药获得上品(品质系数2.0), **When** 炼制完成, **Then** 获得炼丹经验=3×10×2.0=60点经验
6. **Given** 玩家炼制5阶丹药获得极品(品质系数3.0), **When** 炼制完成, **Then** 获得炼丹经验=5×10×3.0=150点经验
7. **Given** 玩家炼制4阶丹药失败, **When** 炼制完成, **Then** 获得炼丹经验=4×10×1.0×50%=20点经验(失败获得50%经验)
8. **Given** 玩家炼丹经验达到100点, **When** 炼丹等级从1级升级到2级, **Then** 炼制成功率加成从+5%提升到+10%,可炼制丹药品阶范围不变(1-2阶)
9. **Given** 玩家确认炼丹, **When** 炼制过程完成, **Then** 根据概率获得丹药并判定品质:下品(60%)/中品(30%)/上品(8%)/极品(2%),失败则失去部分材料但仍获得50%经验
10. **Given** 玩家服用聚气丹, **When** 丹药效果生效, **Then** 一定时间内修炼速度提升50%,持续消耗丹药效果
11. **Given** 玩家服用突破丹, **When** 尝试境界突破, **Then** 突破成功率提升20%,丹药消耗品

---

### User Story 6 - 炼器系统 (Priority: P6)

玩家可以通过炼器炉,消耗矿石和材料炼制法器装备,提升角色战斗力和修炼效率。

**Why this priority**: 炼器提供角色属性提升途径,是战斗力和修炼效率的重要保障。P6 完成后玩家可以体验"收集矿石→炼制法器→装备→属性提升"的装备养成循环。

**Independent Test**: 可以通过收集矿石、按器方炼器、装备法器验证属性提升来独立验证炼器系统功能完整。

**Acceptance Scenarios**:

1. **Given** 玩家拥有炼器炉和矿石材料, **When** 选择"炼器"并指定器方, **Then** 显示所需材料、炼制时间、成功率(基础成功率+境界加成+悟性加成+炉品质加成+炼器等级加成)、成品品质范围
2. **Given** 玩家炼器等级为1级(学徒), **When** 尝试炼制装备, **Then** 只能炼制普通品质装备,成功率加成+4%,装备属性加成+2%
3. **Given** 玩家炼器等级为5级, **When** 尝试炼制装备, **Then** 可炼制普通、稀有、史诗品质装备,成功率加成+20%,装备属性加成+10%
4. **Given** 玩家炼器等级为10级(铸器大师), **When** 尝试炼制装备, **Then** 可炼制所有品质装备(包括仙品),成功率加成+40%,装备属性加成+20%
5. **Given** 玩家炼制普通品质装备, **When** 炼制完成, **Then** 获得炼器经验=品质基础值10×强化等级系数1.0=10点经验
6. **Given** 玩家炼制史诗品质装备, **When** 炼制完成, **Then** 获得炼器经验=品质基础值60×强化等级系数1.0=60点经验
7. **Given** 玩家炼制传说品质装备失败, **When** 炼制完成, **Then** 获得炼器经验=品质基础值100×强化等级系数1.0×50%=50点经验(失败获得50%经验)
8. **Given** 玩家炼器经验达到150点, **When** 炼器等级从1级升级到2级, **Then** 炼制成功率加成从+4%提升到+8%,装备属性加成从+2%提升到+4%,可炼制品质范围不变(普通)
9. **Given** 玩家确认炼器, **When** 炼制过程完成, **Then** 根据概率和炼器等级获得不同品质装备,装备随机属性受炼器等级影响,失败则失去部分材料但仍获得50%经验
10. **Given** 玩家装备攻击类法器(如飞剑), **When** 进行战斗, **Then** 战斗力提升,体现在战斗力和战斗结果上
11. **Given** 玩家装备修炼类法器(如聚灵珠), **When** 进行修炼, **Then** 修炼效率提升,每次修炼获得额外灵气值
12. **Given** 玩家选择强化装备, **When** 强化成功, **Then** 装备属性提升,消耗5体力; **When** 强化失败, **Then** 装备可能掉级,消耗2.5体力(减半)

---

### User Story 7 - 技能系统 (Priority: P7)

玩家可以通过修炼功法、领悟技能,获得战斗和修炼的特殊能力,提升角色实力。

**Why this priority**: 技能是角色战斗力和修炼效率的关键因素,提供多样化的玩法选择。P7 完成后玩家可以体验"学习功法→领悟技能→装备技能→使用技能战斗→升级技能"的技能养成循环。

**Independent Test**: 可以通过学习功法、装备技能、使用技能战斗、升级技能验证效果来独立验证技能系统功能完整。

**Acceptance Scenarios**:

1. **Given** 玩家获得功法秘籍, **When** 选择学习功法, **Then** 满足境界和悟性要求后学会功法,解锁技能
2. **Given** 玩家通过宗门贡献度在宗门商店学习特色技能(如火球术-火系攻击技能), **When** 学习条件满足(境界要求、贡献度消耗、职位要求), **Then** 学会该技能,技能加入已学技能列表
3. **Given** 玩家使用灵石在商店购买通用技能(如冰锥术-冰系攻击技能), **When** 支付灵石, **Then** 学会该技能,技能加入已学技能列表
4. **Given** 玩家完成宗门任务或探索事件获得技能奖励(如雷击术-雷系攻击技能), **When** 任务完成或事件触发, **Then** 学会该技能,技能加入已学技能列表
5. **Given** 玩家在探索奇遇中获得上古传承技能(如高级火系技能), **When** 领悟传承并额外消耗10体力, **Then** 学会该技能,技能加入已学技能列表
6. **Given** 玩家学会火系攻击技能(如火球术-火系攻击技能,技能基础伤害100,技能倍率2.0),攻击力200,目标火系抗性30%, **When** 在战斗中选择使用技能, **Then** 计算伤害=(100+200×2.0)×(1-0.30)=500×0.70=350点火系伤害,可能附加持续灼烧效果
7. **Given** 玩家学会冰系攻击技能(如冰锥术-冰系攻击技能,技能基础伤害80,技能倍率1.5),攻击力200,目标冰系抗性40%,暴击触发, **When** 在战斗中对敌人使用, **Then** 计算伤害=(80+200×1.5)×(1-0.40)=380×0.60=228,最终伤害=228×200%=456点冰系伤害(暴击双倍),可能附加减速效果(敌人下回合速度降低)
8. **Given** 玩家学会雷系攻击技能(如雷击术-雷系攻击技能,技能基础伤害120,技能倍率1.8),攻击力200,目标雷系抗性20%, **When** 在战斗中对敌人使用, **Then** 计算伤害=(120+200×1.8)×(1-0.20)=480×0.80=384点雷系伤害,可能附加麻痹效果(敌人下回合无法行动)
9. **Given** 玩家学会物理系攻击技能(如重击-物理系攻击技能,技能基础伤害150,技能倍率1.2),攻击力200,目标物理抗性25%,目标无元素抗性, **When** 在战斗中对敌人使用, **Then** 计算伤害=(150+200×1.2)×(1-0.25)=390×0.75=292.5点物理伤害,无视元素抗性
10. **Given** 玩家装备提供物理抗性10%、冰系抗性15%、火系抗性20%、雷系抗性5%, **When** 计算总抗性, **Then** 物理抗性=10%,冰系抗性=15%,火系抗性=20%,雷系抗性=5%,所有抗性可叠加,单种抗性上限75%
11. **Given** 玩家装备多件装备提供火系抗性(铠甲30%+头盔25%+靴子20%), **When** 计算总火系抗性, **Then** 火系抗性=30%+25%+20%=75%(达到上限,不再继续叠加)
12. **Given** 玩家学会防御类技能(如护体术), **When** 在战斗中使用, **Then** 消耗灵气提升防御力,持续一定回合或受到一定伤害后失效
13. **Given** 玩家学会治疗类技能(如回春术), **When** 在战斗中使用, **Then** 消耗灵气恢复生命值,可能附加持续恢复效果
14. **Given** 玩家学会辅助类技能(如加速术), **When** 在战斗中使用, **Then** 消耗灵气提升速度或暴击率,持续一定回合
15. **Given** 玩家学会修炼类技能(如冥想法), **When** 修炼时激活技能, **Then** 修炼效率提升,获得额外灵气值
16. **Given** 玩家已学习5个攻击技能和3个辅助技能, **When** 打开技能装备界面, **Then** 显示6个技能槽位(4个攻击技能槽、2个辅助技能槽),显示所有已学技能(按功能分类:攻击/防御/辅助/治疗;按元素分类:物理/冰系/火系/雷系)
17. **Given** 玩家选择装备攻击技能, **When** 从已学攻击技能中选择4个技能装备到攻击技能槽, **Then** 装备成功,这4个技能可在战斗中使用
18. **Given** 玩家尝试装备第5个攻击技能, **When** 攻击技能槽已满(4个), **Then** 系统提示"攻击技能槽已满,最多装备4个攻击技能",需卸载或替换已有技能
19. **Given** 玩家选择装备辅助技能, **When** 从已学辅助技能(包括防御/治疗技能)中选择2个技能装备到辅助技能槽, **Then** 装备成功,这2个技能可在战斗中使用
20. **Given** 玩家尝试装备第3个辅助技能, **When** 辅助技能槽已满(2个), **Then** 系统提示"辅助技能槽已满,最多装备2个辅助技能",需卸载或替换已有技能
21. **Given** 玩家尝试装备未学习的技能, **When** 打开技能装备界面, **Then** 只显示已学技能,未学技能无法装备,系统提示"需要先学习该技能"
22. **Given** 玩家进入战斗, **When** 显示战斗选项, **Then** 只显示已装备的技能(4个攻击技能、2个辅助技能),未装备的技能无法使用
23. **Given** 玩家在非战斗状态, **When** 选择卸载已装备技能, **Then** 技能从槽位中移除,该技能无法在战斗中使用,但技能仍在已学技能列表中
24. **Given** 玩家在非战斗状态, **When** 选择用新技能替换已装备技能, **Then** 已装备技能自动卸载,新技能装备到槽位,槽位数量不变
25. **Given** 玩家在战斗中, **When** 尝试更换已装备技能, **Then** 系统提示"战斗中无法更换技能",需战斗结束后才能更换
26. **Given** 玩家频繁使用技能, **When** 技能熟练度提升, **Then** 技能升级,技能倍率提升(如从1.5提升到1.8),伤害提升,或灵气消耗降低

---

### User Story 8 - 装备管理系统 (Priority: P8)

玩家可以管理装备栏,装备、卸下、强化、镶嵌宝石来提升装备属性和角色战斗力。

**Why this priority**: 装备管理是角色养成的重要部分,提供深度的属性定制。P8 完成后玩家可以体验"装备法器→强化装备→镶嵌宝石→提升属性"的装备养成循环。

**Independent Test**: 可以通过装备法器、强化装备、镶嵌宝石验证属性提升来独立验证装备管理系统功能完整。

**Acceptance Scenarios**:

1. **Given** 玩家获得武器装备, **When** 查看武器属性, **Then** 显示攻击力、暴击率(最高15%)、速度等属性,并显示装备槽位信息(武器槽1个)
2. **Given** 玩家获得防具装备(头盔/铠甲/护手/护腿/靴子), **When** 查看防具属性, **Then** 显示防御力、生命值、物理抗性、冰系抗性、火系抗性、雷系抗性等属性,并显示装备槽位信息(防具槽5个)
3. **Given** 玩家获得项链装备, **When** 查看项链属性, **Then** 显示生命值、攻击力、防御力、暴击率(最高10%)、元素抗性等属性,并显示装备槽位信息(项链槽1个)
4. **Given** 玩家获得戒指装备, **When** 查看戒指属性, **Then** 显示生命值、攻击力、防御力、元素抗性等属性,并显示装备槽位信息(戒指槽2个)
5. **Given** 玩家尝试装备戒指, **When** 装备第1枚戒指, **Then** 装备成功,可继续装备第2枚戒指
6. **Given** 玩家已装备2枚戒指, **When** 尝试装备第3枚戒指, **Then** 系统提示"戒指部位已满,最多装备2枚",需卸下一枚才能装备
7. **Given** 玩家获得品质为传说/仙品的装备, **When** 查看装备信息, **Then** 显示品质(传说/仙品)、随机属性范围、基础属性高于普通品质装备
8. **Given** 玩家已装备武器, **When** 获得新武器, **Then** 可选择替换或放弃新装备,系统显示属性对比(攻击力、暴击率、速度等)
9. **Given** 玩家装备栏已满(9个装备位:武器×1/头盔×1/铠甲×1/护手×1/护腿×1/靴子×1/戒指×2/项链×1), **When** 获得新装备, **Then** 可选择替换装备或出售新装备,系统显示属性对比
10. **Given** 玩家选择强化装备, **When** 消耗强化材料和5体力, **Then** 装备强化等级+1(最高15级),属性提升; **When** 强化失败, **Then** 消耗2.5体力,装备可能掉级或损坏
11. **Given** 玩家拥有宝石和有孔装备, **When** 选择镶嵌宝石, **Then** 装备获得额外属性加成,宝石可拆卸
12. **Given** 玩家装备带有元素抗性的防具, **When** 装备多件同系抗性装备, **Then** 抗性可叠加,单件最高+15%,总抗性上限75%,系统提示"该元素抗性已达上限"
13. **Given** 玩家查看装备详情, **When** 显示装备信息, **Then** 包含装备类型(武器/防具/饰品)、装备槽位、品质(普通/稀有/史诗/传说/仙品)、装备评分(0-10000分)、基础属性、随机属性、抗性、强化等级(0-15级)
14. **Given** 玩家查看普通品质武器(品质基础分100)有50点攻击力和5级强化, **When** 计算装备评分, **Then** 评分=100+50×2+5×50=400分(品质基础分+主属性×属性系数+强化等级×强化系数)
15. **Given** 玩家查看稀有品质铠甲(品质基础分300)有100点防御力、10%物理抗性、3级强化、1个特殊效果, **When** 计算装备评分, **Then** 评分=300+100×2+10×3+3×50+1×100=730分(品质基础分+主属性×2+抗性×3+强化等级×50+特殊效果×100)
16. **Given** 玩家查看传说品质项链(品质基础分1000)有10%暴击率、20%火系抗性、10级强化、2个特殊效果, **When** 计算装备评分, **Then** 评分=1000+10×3+20×3+10×50+2×100=1950分(品质基础分+暴击率×3+火系抗性×3+强化等级×50+特殊效果×100)
17. **Given** 玩家使用一键售卖功能, **When** 设置评分阈值为1000分, **Then** 系统扫描背包,自动选中评分低于1000的未装备装备,显示售卖列表(装备名称、品质、评分、售卖价格)和总售卖价格(评分×品质系数)
18. **Given** 玩家背包中有3件普通品质装备(评分400/500/600)、2件稀有品质装备(评分700/900)、1件史诗品质装备(评分1500), **When** 设置评分阈值为1000并执行一键售卖, **Then** 系统选中普通品质3件(400×1=400/500×1=500/600×1=600)和稀有品质2件(700×2=1400/900×2=1800),史诗品质装备因评分1500高于阈值不被选中,总售卖价格=400+500+600+1400+1800=4700灵石
19. **Given** 玩家确认一键售卖, **When** 售卖完成, **Then** 获得总售卖价格4700灵石,已装备的装备保持不变,背包中移除已售卖的5件装备,系统显示"售卖成功,获得4700灵石"
20. **Given** 玩家尝试设置评卖阈值为负数或超过10000, **When** 输入无效阈值, **Then** 系统提示"阈值范围应在0-10000之间",并限制阈值为合理范围
21. **Given** 玩家设置评分阈值为100分但背包中所有装备评分都高于100分, **When** 执行一键售卖, **Then** 系统提示"没有符合条件的装备可售卖"
22. **Given** 玩家使用一键售卖功能, **When** 背包中有已装备的装备(如评分800的武器),评分低于阈值, **Then** 已装备的装备不会被选中售卖,系统显示"已装备的装备不会售卖"提示

---

### User Story 9 - 宗门系统 (Priority: P9)

玩家可以加入修仙宗门,完成宗门任务获取资源,学习宗门功法,参与宗门战,体验团队协作。

**Why this priority**: 宗门系统提供社交玩法和长期目标,增加游戏的深度和归属感。P9 完成后玩家可以体验"加入宗门→完成宗门任务→获取宗门贡献→兑换奖励→学习宗门技能→晋升职位→宗门战"的社交循环。

**Independent Test**: 可以通过申请加入宗门、完成宗门任务、兑换宗门奖励、学习宗门技能来独立验证宗门系统功能完整。

**Acceptance Scenarios**:

1. **Given** 玩家达到练气期, **When** 访问宗门列表(青云剑宗、丹霞谷、天机阁、无极魔宗、万兽山庄), **Then** 显示每个宗门的特色、加入要求、职位体系
2. **Given** 玩家选择申请加入青云剑宗, **When** 宗门根据玩家境界和属性决定录取, **Then** 录取后玩家成为外门弟子,获得基础宗门福利
3. **Given** 玩家作为外门弟子, **When** 访问宗门技能库, **Then** 只能学习1-2阶基础技能,如青云剑宗的基础剑法技能(物理系攻击)
4. **Given** 玩家作为外门弟子, **When** 尝试学习3阶以上进阶技能, **Then** 系统提示"职位等级不足,需要达到内门弟子才能学习1-4阶技能"
5. **Given** 玩家完成宗门任务积累贡献和声望, **When** 达到晋升条件, **Then** 可以晋升为内门弟子,解锁1-4阶进阶技能学习权限,获得晋升奖励技能
6. **Given** 玩家作为内门弟子, **When** 继续积累贡献和声望, **Then** 可以晋升为长老,解锁1-6阶高级技能学习权限
7. **Given** 玩家作为长老, **When** 达到最高贡献和声望, **Then** 可以晋升为宗主,解锁所有1-8阶宗门技能学习权限
8. **Given** 玩家作为内门弟子加入丹霞谷, **When** 访问宗门技能库, **Then** 可学习炼丹辅助技能(治疗、增益类技能),如回春术、聚气术
9. **Given** 玩家作为内门弟子加入天机阁, **When** 访问宗门技能库, **Then** 可学习法术系技能(元素攻击为主),如火球术(火系)、冰锥术(冰系)、雷击术(雷系)
10. **Given** 玩家作为内门弟子加入无极魔宗, **When** 访问宗门技能库, **Then** 可学习魔功技能(高伤害、有副作用),如燃血术(消耗生命值提升攻击力)
11. **Given** 玩家作为内门弟子加入万兽山庄, **When** 访问宗门技能库, **Then** 可学习驯兽技能(召唤、辅助类),如召唤妖兽、兽魂附体
12. **Given** 玩家作为内门弟子加入青云剑宗, **When** 访问宗门技能库, **Then** 可学习剑法系技能(物理系攻击为主),如飞剑术、剑气斩
13. **Given** 玩家使用贡献度在宗门技能库兑换技能, **When** 支付贡献度, **Then** 学会对应技能,技能加入已学技能列表
14. **Given** 玩家完成宗门任务, **When** 任务奖励为技能, **Then** 直接学会对应技能,无需额外消耗贡献度
15. **Given** 玩家晋升职位, **When** 晋升奖励包含特定技能, **Then** 直接学会对应技能,无需额外消耗贡献度
16. **Given** 玩家尝试学习技能但贡献度不足, **When** 访问宗门技能库, **Then** 系统提示"贡献度不足,需要XX贡献度才能学习该技能"
17. **Given** 玩家尝试学习技能但境界要求不足, **When** 访问宗门技能库, **Then** 系统提示"境界要求不足,需要达到XX境界才能学习该技能"
18. **Given** 玩家尝试学习其他宗门的特色技能, **When** 访问宗门技能库, **Then** 系统提示"该技能为其他宗门专属,无法学习"
19. **Given** 玩家完成宗门任务(击杀妖兽、采集灵草、炼丹炼器), **When** 任务完成, **Then** 获得宗门贡献和宗门声望
20. **Given** 玩家有足够宗门贡献, **When** 在宗门商店兑换奖励, **Then** 获得稀有功法秘籍、丹药、材料
21. **Given** 玩家加入宗门, **When** 宗门战开启, **When** 参与宗门战击败敌对宗门成员, **Then** 获得宗门战奖励和宗门排名提升

---

### User Story 10 - 境界突破与飞升系统 (Priority: P10)

玩家可以从炼气期开始,经历筑基、结丹、元婴、化神、炼虚、合体、大乘,最终飞升成仙(真仙、金仙、太乙、大罗、道祖)。

**Why this priority**: 完整的修炼境界体系提供长期目标和成就感,是游戏的核心吸引力。P10 完成后玩家可以体验从凡人到道祖的完整修仙之路。

**Independent Test**: 可以通过快速提升境界,验证每个境界的突破条件和难度曲线是否合理。

**Acceptance Scenarios**:

1. **Given** 玩家达到炼气期九层, **When** 积累足够经验值并满足突破条件, **Then** 可尝试突破筑基期,成功则晋升,失败则成为散修或消耗部分灵气
2. **Given** 玩家在某个境界的一层至八层, **When** 积累经验值达到升级需求, **Then** 自动晋升至下一层,无需突破
3. **Given** 玩家在某个境界九层, **When** 积累足够经验值, **Then** 可尝试突破下一大境界,突破需要满足额外条件(灵气满、心境达标、特殊机缘)
4. **Given** 玩家进入新境界(如筑基期、结丹期、元婴期), **When** 解锁对应新的功法和技能, **Then** 战斗力和修炼效率大幅提升
5. **Given** 玩家达到大乘期圆满, **When** 完成渡劫挑战, **Then** 成功则飞升至真仙境(游戏新阶段),失败则兵解重修
6. **Given** 玩家突破失败, **When** 境界跌落或受伤, **Then** 需要重新积累经验值才能再次突破

---

### Edge Cases

**体力相关**:
- 当玩家体力耗尽时,系统应强制进入休息状态,无法进行战斗、炼丹、炼器、探索操作,只能打坐或休息
- 当玩家体力不足但不为0时,系统应提示当前体力值,并允许继续操作(如果体力足够)
- 当玩家体力低于操作消耗需求时(如体力8点但炼丹需要10点),系统应提示"体力不足,需要XX点体力",无法进行该操作
- 当玩家使用回体丹药时,体力恢复不应超过体力上限
- 当玩家体质属性提升时,体力上限应同步增加,当前体力值不变(不超过新的上限)
- 当玩家选择炼丹时,系统应显示该丹药的体力消耗(如"炼制聚气丹需要10点体力")
- 当玩家选择炼器时,系统应显示炼器的体力消耗(如"炼制法器需要20点体力")
- 当玩家选择探索时,系统应显示探索区域的体力消耗(如"探索危险区域需要15点体力")
- 当玩家挑战BOSS时体力不足(如体力25点但BOSS需要30点),系统应提示"体力不足,无法挑战BOSS"

**修炼和突破相关**:
- 当玩家悟性提升时,每次修炼获得的经验值应相应增加(修炼基础经验=境界基础值×悟性系数)
- 当玩家机缘提升时,境界突破成功率应相应增加(突破成功率=(基础成功率+丹药加成)×机缘系数)
- 当突破成功率超过100%时,系统应按100%计算(必定突破)
- 当玩家突破失败后,系统应明确显示失败原因(成功率、运气不足等)并提供重试选项
- 当玩家使用突破丹时,系统应计算并显示新的突破成功率(基础成功率+丹药加成)×机缘系数
- 当境界基础值提升(从低境界到高境界),每次修炼获得的经验值也相应增加

**战斗相关**:
- 当玩家气运(决定速度)高于妖兽速度时,玩家先行动;当妖兽速度高于玩家气运时,妖兽先行动
- 当玩家选择逃跑时,根据气运(决定速度)计算逃跑成功率,成功则结束战斗,失败则继续战斗
- 当玩家战斗中灵气不足时,无法使用消耗灵气的技能,只能普通攻击或使用物品
- 当玩家背包中没有可用物品时,战斗中"使用物品"选项应禁用或提示"无可用物品"
- 当战斗胜利但体力不足时,玩家应获得奖励但无法继续探索,需要休息
- 当妖兽具有高元素抗性(如50%火系抗性)时,系统应提示玩家选择对应元素技能以最大化伤害
- 当玩家对抗具有特定抗性的妖兽时(如火焰蜥蜴火抗50%),系统应提示使用克制元素技能(如冰系技能)以获得最大伤害,而非使用被克制的元素技能
- 当玩家某种元素抗性超过75%时,系统应按75%计算并提示"该元素抗性已达上限"
- 当暴击触发时,系统应显示"暴击!"视觉提示和伤害数值
- 当暴击率超过100%时,系统应按100%计算(必定暴击)
- 当玩家装备多件暴击装备时,暴击率可叠加(基础5%+武器最高15%+项链最高10%),总暴击率上限30%(武器+项链)
- 当玩家体力不足挑战精英妖兽(需20体力)或BOSS(需30体力)时,系统应提示"体力不足,无法挑战"
- 当玩家战斗失败时,系统应扣除减半体力(普通妖兽5点、精英妖兽10点、BOSS 15点),并显示"战斗失败,消耗X点体力"
- 当妖兽抗性为负数时,系统应将伤害提升超过100%(如-20%抗性造成120%伤害)
- 当伤害计算结果为负数或0时,系统应强制造成1点最低伤害(避免无效攻击)
- 当玩家选择手动战斗模式时,系统应在每个回合开始时显示战斗选项,等待玩家手动选择行动
- 当玩家选择自动战斗模式时,系统应自动选择最优行动(普通攻击或技能,根据怪物抗性和灵气值判断),无需玩家操作
- 当玩家在自动战斗模式下灵气不足时,系统应自动使用普通攻击而非技能
- 当玩家在自动战斗模式下所有技能灵气都不足时,系统应只使用普通攻击
- 当玩家选择挂机战斗模式时,系统应自动选择可挑战的怪物(优先选择玩家可击败的怪物)
- 当玩家挂机战斗中体力或气血归零时,系统应自动停止挂机,显示"挂机结束,体力/气血不足"
- 当玩家挂机战斗进行中时,玩家应可以主动停止挂机,显示挂机统计信息(战斗场次、获得经验、获得奖励)
- 当玩家挂机战斗中背包已满时,系统应继续战斗但不再获得掉落物品,只获得经验值
- 当玩家挂机战斗时,系统应自动跳过战斗动画,直接显示战斗结果
- 当玩家挂机战斗中断开连接或关闭应用时,系统应保存挂机状态,重新连接后继续挂机
- 当玩家挂机战斗中遇到BOSS时,系统应默认跳过BOSS(或根据设置选择挑战/跳过)
- 当玩家挂机战斗中连续战斗失败3次时,系统应暂停挂机,提示"连续战斗失败,请检查装备或修炼后继续"
- 当玩家挂机战斗时,系统应记录并显示挂机统计(开始时间、战斗场次、获得经验、获得灵石、获得装备、获得材料)
- 当玩家从挂机战斗模式切换到其他模式时,系统应等待当前战斗完成后停止挂机
- 当怪物列表为空时,系统应提示"当前无可挑战的怪物",无法进入战斗
- 当玩家选择指定的怪物时,系统应显示该怪物的详细信息(境界、类型、攻击元素类型、元素抗性、体力消耗、掉落奖励)
- 当玩家选择的怪物等级远高于玩家境界时,系统应提示"怪物实力远超于你,建议谨慎挑战",但仍允许挑战
- 当玩家挑战的怪物所需体力大于当前体力时,系统应提示"体力不足,无法挑战该怪物"

**装备相关**:
- 当玩家装备栏已满(9个装备位)时,获得新装备应提示替换或放弃
- 当玩家尝试装备第3枚戒指时,系统应提示"戒指部位已满,最多装备2枚"
- 当玩家装备多件同系抗性装备时,总抗性达到75%后应停止叠加,提示"抗性已达上限"
- 当玩家使用一键售卖时,已装备的装备应自动排除,无法被选中
- 当玩家设置评分阈值为负数或超过10000时,系统应限制阈值为合理范围(0-10000)并提示"阈值范围应在0-10000之间"
- 当玩家设置评分阈值为100分但背包中所有装备评分都高于100分时,系统应提示"没有符合条件的装备可售卖"
- 当玩家背包中没有装备时,系统应禁用一键售卖功能或提示"背包中没有装备"
- 当玩家确认一键售卖时,系统应显示售卖列表(装备名称、品质、评分、售卖价格)和总收益预览(灵石)
- 当玩家确认售卖后,系统应从背包移除已售卖装备,并将售卖价格(评分×品质系数)添加到玩家灵石
- 当售卖价格计算时,系统应根据装备品质应用品质系数(普通×1/稀有×2/史诗×4/传说×8/仙品×15)
- 当强化装备失败时,应提供保护机制避免装备永久损坏(如使用保护符)
- 当宝石拆卸时,应提示是否确认拆卸,拆卸后宝石返还给玩家

**技能相关**:
- 当玩家尝试装备未学习的技能时,系统应禁止装备并提示"需要先学习该技能"
- 当玩家装备技能槽位已满(攻击技能槽4个、辅助技能槽2个)时,系统应提示"技能槽已满",需卸载或替换已有技能
- 当玩家进入战斗时,系统应只显示已装备的技能,未装备的技能无法在战斗中使用
- 当玩家在战斗中尝试更换已装备技能时,系统应提示"战斗中无法更换技能",需战斗结束后才能更换
- 当玩家使用攻击技能时,系统应根据技能伤害计算公式计算伤害:计算伤害=(技能基础伤害+攻击力×技能倍率)×(1-对应属性的抗性)
- 当玩家使用攻击技能时,系统应根据计算结果应用暴击伤害率:最终伤害=计算伤害×暴击伤害率(未暴击100%/暴击200%)
- 当玩家使用物理系技能时,系统应根据物理抗性计算伤害:计算伤害=(技能基础伤害+攻击力×技能倍率)×(1-物理抗性),无视元素抗性
- 当玩家使用冰系技能时,系统应根据冰系抗性计算伤害:计算伤害=(技能基础伤害+攻击力×技能倍率)×(1-冰系抗性),并根据概率触发减速效果
- 当玩家使用火系技能时,系统应根据火系抗性计算伤害:计算伤害=(技能基础伤害+攻击力×技能倍率)×(1-火系抗性),并根据概率触发持续灼烧效果
- 当玩家使用雷系技能时,系统应根据雷系抗性计算伤害:计算伤害=(技能基础伤害+攻击力×技能倍率)×(1-雷系抗性),并根据概率触发麻痹效果
- 当玩家装备多件装备提供同种抗性时,系统应累加抗性(如铠甲30%+头盔25%+靴子20%=75%),达到75%上限后不再继续叠加
- 当玩家抗性累加超过75%时,系统应按75%计算并提示"该抗性已达上限"
- 当玩家技能伤害计算结果为负数或0时,系统应强制造成1点最低伤害(避免无效攻击)
- 当玩家通过宗门学习技能时,系统应检查学习条件(境界要求、贡献度消耗、职位要求),条件满足后才能学习
- 当玩家购买技能时,系统应扣除相应灵石后学会技能
- 当玩家完成任务或触发探索事件时,系统应根据奖励类型直接学会对应技能
- 当玩家获得传承技能时,系统应额外消耗10体力(领悟消耗)后学会技能
- 当技能升级时,系统应提升技能倍率(如从1.5提升到1.8),提升技能伤害,或降低灵气消耗
- 当玩家卸载技能时,技能从槽位中移除,该技能无法在战斗中使用,但技能仍在已学技能列表中
- 当玩家在非战斗状态时,可以随时更换已装备的技能(装备/卸载/替换)
- 当玩家使用防御类技能时,系统应提升防御力,持续一定回合或受到一定伤害后失效
- 当玩家使用治疗类技能时,系统应恢复生命值,可能附加持续恢复效果
- 当玩家使用辅助类技能时,系统应提升速度或暴击率,持续一定回合
- 当玩家使用修炼类技能时,系统应在修炼时提升修炼效率,获得额外灵气值

**数据持久化相关**:
- 当MySQL数据库连接失败时,系统应提示"无法连接数据库,请检查网络连接",并提供重试选项
- 当数据保存失败时,系统应提示"存档失败",并提供重试或退出选项
- 当数据加载失败时,系统应提示"存档损坏",并提供恢复备份或创建新角色选项
- 当数据库事务失败时,系统应回滚到之前的状态,避免数据不一致
- 当玩家创建新角色时,系统应在MySQL数据库中创建新的角色记录
- 当玩家删除角色时,系统应从MySQL数据库中删除该角色及其所有关联数据
- 当数据库磁盘空间不足时,系统应提示"存储空间不足,无法存档"
- 当玩家突破失败多次后,应提供"散修"路线或降低难度机制,避免死局
- 当玩家资源不足时,应提供"乞讨/打工"等保底机制获取基础资源
- 当玩家达到境界瓶颈时,应通过"机缘事件"(奇遇、秘境)提供突破机会
- 当玩家连续战斗失败,应提供"逃亡/隐忍"选项避免角色死亡
- 当炼丹或炼器失败时,部分材料应永久消耗,但保留核心材料避免彻底损失
- 当玩家炼丹等级不足时,系统应禁止炼制高阶丹药并提示"炼丹等级不足,需要X级才能炼制Y阶丹药"
- 当玩家炼丹经验达到升级需求时,系统应自动提升炼丹等级并提示"炼丹等级提升至X级,成功率加成+Y%"
- 当玩家炼丹失败时,系统应给予50%经验值并提示"炼丹失败,获得X点经验(50%)"
- 当炼丹品质判定为极品时,系统应显示特殊提示"炼丹成功!获得极品丹药!"并给予额外经验值加成(品质系数3.0)
- 当玩家炼器等级不足时,系统应禁止炼制高品质装备并提示"炼器等级不足,需要X级才能炼制Y品质装备"
- 当玩家炼器经验达到升级需求时,系统应自动提升炼器等级并提示"炼器等级提升至X级,成功率加成+Y%,属性加成+Z%"
- 当玩家炼器失败时,系统应给予50%经验值并提示"炼器失败,获得X点经验(50%)"
- 当炼器品质判定为传说或仙品时,系统应显示特殊提示"炼器成功!获得传说/仙品装备!"并给予额外经验值加成(品质基础值100/200)
- 当强化装备失败时,装备可能掉级并提示"强化失败,装备等级降低",消耗体力减半(2.5点)
- 当玩家体力不足5点时,系统应禁止普通探索并提示"体力不足,需要5点体力"
- 当玩家体力不足15点时,系统应禁止深入探索并提示"体力不足,需要15点体力"
- 当探索触发战斗事件时,系统应额外消耗战斗体力(普通10/精英20/BOSS 30),并在战斗结束后显示"探索战斗消耗X点体力"
- 当探索触发传承事件时,系统应额外消耗10体力(领悟消耗),并提示"领悟传承,消耗10点体力"
- 当玩家气运为10(高气运)时,触发TREASURE、ENCOUNTER、INHERITANCE等有利事件概率应显著提升,系统提示"福星高照,遇到奇遇!"
- 当玩家气运为1(低气运)时,触发DANGER危险事件概率提升,系统应提示"时运不济,遭遇危险!"
- 当装备栏已满时,玩家应能够选择替换装备或放弃新装备
- 当装备强化等级达到15级(上限)时,系统应禁止继续强化并提示"装备已强化至最高等级"
- 当装备品质为传说或仙品时,系统应显示特殊品质标识,基础属性和随机属性范围高于普通品质装备
- 当装备暴击率超过上限时(武器15%、项链10%),系统应按上限计算并提示"暴击率已达上限"
- 当装备评分超过10000分时,系统应按10000分计算(评分上限)
- 当玩家查看装备详情时,系统应显示装备评分和计算明细(品质基础分、主属性贡献、抗性贡献、强化贡献、特殊效果贡献)
- 当玩家使用一键售卖功能时,系统应根据装备评分自动筛选低于阈值的装备,已装备的装备不会被选中
- 当玩家炼制出高品质法器但境界不足时,应提供"封存"机制或降低法器效果
- 当技能灵气消耗超过当前灵气值时,系统应禁止使用该技能并提示
- 当强化装备失败时,应提供保护机制避免装备永久损坏(如使用保护符)
- 当玩家申请加入宗门被拒绝时,应提供提升属性后重新申请的机会
- 当宗门贡献不足时,玩家应无法兑换宗门奖励,系统提示贡献需求
- 当玩家打坐期间,系统应禁止进行其他操作(修炼、探索、战斗、炼丹、炼器)

**宗门相关**:
- 当玩家访问宗门列表时,系统应显示所有宗门(青云剑宗、丹霞谷、天机阁、无极魔宗、万兽山庄)及其特色、加入要求、职位体系
- 当玩家申请加入宗门时,系统应根据玩家境界和属性决定是否录取
- 当玩家被宗门录取后,系统应自动设置玩家职位为外门弟子,授予基础宗门福利
- 当外门弟子访问宗门技能库时,系统应只显示1-2阶基础技能
- 当外门弟子尝试学习3阶以上技能时,系统应提示"职位等级不足,需要达到内门弟子才能学习1-4阶技能"
- 当内门弟子访问宗门技能库时,系统应显示1-4阶进阶技能
- 当长老访问宗门技能库时,系统应显示1-6阶高级技能
- 当宗主访问宗门技能库时,系统应显示所有1-8阶宗门技能
- 当玩家完成宗门任务积累足够贡献和声望时,系统应提示可以晋升职位,显示晋升条件和奖励
- 当玩家晋升职位时,系统应授予新职位权限,解锁对应技能学习权限,并给予晋升奖励技能
- 当青云剑宗弟子访问技能库时,系统应显示剑法系技能(物理系攻击为主)
- 当丹霞谷弟子访问技能库时,系统应显示炼丹辅助技能(治疗、增益类技能)
- 当天机阁弟子访问技能库时,系统应显示法术系技能(元素攻击为主)
- 当无极魔宗弟子访问技能库时,系统应显示魔功技能(高伤害、有副作用)
- 当万兽山庄弟子访问技能库时,系统应显示驯兽技能(召唤、辅助类)
- 当玩家使用贡献度兑换技能时,系统应扣除贡献度后学会对应技能
- 当玩家完成宗门任务获得技能奖励时,系统应直接学会对应技能,无需额外消耗贡献度
- 当玩家晋升职位获得技能奖励时,系统应直接学会对应技能,无需额外消耗贡献度
- 当玩家贡献度不足时,系统应提示"贡献度不足,需要XX贡献度才能学习该技能",禁止学习
- 当玩家境界要求不足时,系统应提示"境界要求不足,需要达到XX境界才能学习该技能",禁止学习
- 当玩家尝试学习其他宗门特色技能时,系统应提示"该技能为其他宗门专属,无法学习",禁止学习
- 当玩家打坐被打断(主动取消),系统应根据已打坐时间按比例恢复部分属性
- 当玩家尝试装备第3枚戒指时,系统应提示"戒指部位已满,最多装备2枚"
- 当玩家有可用加点点数时,系统应在界面显著位置提示剩余点数
- 当玩家分配加点后,应允许"重置加点"功能(可能消耗特殊道具),但仅在当前境界层次内有效
- 当玩家尝试加点但可用点数为0时,系统应禁止加点并提示"需要先升级获得加点点数"
- 当五维属性达到上限(如999)时,系统应禁止继续加点该属性并提示"属性已达上限"

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须允许玩家创建角色,包含姓名(2-6个汉字)和初始五维属性(体质、精神、气运、悟性、机缘)
- **FR-002**: 系统必须提供文字界面显示角色当前状态(境界、灵气值、体力、心境、五维属性、可用加点、背包)
- **FR-003**: 系统必须提供核心操作菜单(修炼、加点、探索、炼丹、炼器、打坐、突破、查看状态)
- **FR-004**: 系统必须实现修炼经验系统,每次修炼获得经验值,经验值达到升级需求后自动晋升境界层次(1-8层自动升级,9层需突破)
- **FR-005**: 系统必须实现属性加点机制,每次升级境界层次时根据当前境界获得加点点数(炼气期1点/层,筑基期2点/层,结丹期3点/层,境界越高点数越多)
- **FR-006**: 系统必须提供属性加点界面,显示五维属性(体质、精神、机缘、悟性、气运)当前值和可用加点点数
- **FR-007**: 系统必须允许玩家手动分配加点点数到五维属性,每点提升对应属性1点,加点后立即生效并重新计算相关属性值
- **FR-008**: 系统必须实现属性作用机制:
  - 体质影响: 体力最大值=基础值+体质×系数,气血最大值=基础值+体质×系数
  - 精神影响: 灵力最大值=基础值+精神×系数
  - 悟性影响: 修炼基础经验=境界基础值×悟性系数(悟性越高,每次修炼获得的经验值越多)
  - 机缘影响: 战斗胜利后装备掉落率=基础概率+机缘×加成系数,突破成功率=(基础成功率+丹药加成)×机缘系数(机缘越高,突破成功率越高)
  - 气运影响: 攻击暴击率=基础概率+气运×系数,暴击伤害倍数=基础倍率+气运×加成,战斗速度=基础速度+气运×速度系数(速度决定战斗行动顺序)
- **FR-009**: 系统必须实现境界突破机制,包含:
  - 突破条件: 境界9层满足条件(经验值充足、灵气满、心境达标)后可突破下一大境界
  - 突破成功率计算: 突破成功率=(基础成功率+丹药加成)×机缘系数
    - 基础成功率: 根据境界差异确定(如炼气→筑基50%,筑基→结丹40%,境界越高基础成功率越低)
    - 丹药加成: 使用突破丹可提高基础成功率(如突破丹+20%,高级突破丹+30%)
    - 机缘系数: 机缘属性影响最终成功率(机缘1时系数1.0,机缘10时系数1.5,最高不超过2.0)
  - 突破结果: 成功则晋升下一境界,失败则消耗部分灵气或成为散修,可重新尝试突破
- **FR-010**: 系统必须实现体力系统,包含:
  - 初始体力: 玩家创建角色时获得100点体力
  - 体力消耗规则:
    - 战斗消耗: 每场战斗消耗10-30体力(根据战斗难度:普通妖兽10点、精英妖兽20点、BOSS 30点)
    - 战斗失败: 战斗失败时体力消耗减半(普通妖兽5点、精英妖兽10点、BOSS 15点)
    - 炼丹消耗: 炼制低级丹药(1-3阶)消耗5体力、中级丹药(4-6阶)消耗10体力、高级丹药(7-9阶)消耗20体力、仙丹(10阶+)消耗30体力
    - 炼器消耗: 炼制普通装备消耗10体力、稀有/史诗装备消耗20体力、传说/仙品装备消耗30体力
    - 强化装备: 每次强化消耗5体力(不受品质影响)
    - 炼制失败: 体力消耗减半
    - 探索消耗: 普通探索消耗5体力、深入探索(高风险高回报)消耗15体力,触发战斗事件额外消耗战斗体力(普通10/精英20/BOSS 30),触发传承事件额外消耗10体力(领悟消耗)
  - 体力不足规则: 体力低于操作消耗需求时无法进行相应操作,体力为0时只能选择打坐或休息
  - 体力恢复: 通过打坐修炼、休息、使用回体丹药恢复体力
  - 体力上限: 基础上限100点,可通过体质属性提升(最大值=基础值+体质×系数)
- **FR-011**: 系统必须实现打坐恢复功能,玩家可进入打坐状态,打坐默认时长60秒,打坐期间无法进行其他操作
- **FR-012**: 系统必须实现打坐恢复效果,打坐完成后恢复全部体力(100%)、气血(100%)、灵力(100%)
- **FR-013**: 系统必须实现打坐加速机制,学习特定技能(如"冥想法")可减少打坐时间,技能等级越高减少时间越多
- **FR-014**: 系统必须实现法宝加速打坐,装备特定法宝(如"聚灵珠")可减少打坐时间,法宝品质越高减少越多,可叠加
- **FR-015**: 系统必须实现打坐时间下限,即使叠加多种加速效果,打坐时间最短不低于3秒
- **FR-016**: 系统必须实现探索系统,包含:
  - 基础收益: 每次探索获得经验值和灵石
  - 随机事件触发: 根据概率触发不同类型事件(宝藏、危险、奇遇、传承)
  - 事件触发率受气运属性影响(气运越高,触发有利事件概率越高)
  - 事件类型:
    - TREASURE(宝藏): 洞府遗迹、宝箱,获得装备、材料、灵石
    - DANGER(危险): 强盗袭击、陷阱,需要战斗或消耗资源解除
    - ENCOUNTER(奇遇): 遇到高人、商人,获得特殊奖励或交易机会
    - INHERITANCE(传承): 上古传承,获得功法、技能、永久属性提升
  - 体力消耗: 普通探索消耗5体力,深入探索(高风险高回报)消耗15体力,触发战斗事件额外消耗战斗体力,触发传承事件额外消耗10体力(领悟消耗)
- **FR-017**: 系统必须实现回合制战斗系统,包含:
  - 怪物选择: 玩家可以查看可挑战的怪物列表,选择指定怪物进入战斗
  - 战斗模式选择: 玩家进入战斗前可选择战斗模式
    - 手动战斗: 玩家每个回合手动选择行动(普通攻击/使用技能/使用物品/逃跑)
    - 自动战斗: 系统自动选择普通攻击或已装备技能对怪物进行攻击,直到战斗结束
    - 挂机战斗: 自动连续打怪,重复战斗直到体力或气血归零
  - 速度判定: 根据角色气运(决定速度)和妖兽速度确定行动顺序
  - 妖兽元素系统: 每个妖兽具有一种攻击元素类型(物理/冰/火/雷),最多具备2种抗性(0%-50%)
    - 示例妖兽类型:
      - **火焰蜥蜴**(精英火系妖兽): 火系攻击,火系抗性50%、物理抗性20%
      - **冰霜狼**(精英冰系妖兽): 冰系攻击,冰系抗性40%、雷系抗性10%
      - **普通野狼**(普通物理妖兽): 物理攻击,无特殊抗性
  - 玩家回合: 玩家可选择行动(普通攻击/使用技能/使用物品/逃跑),根据怪物抗性选择合适的技能元素
    - 手动战斗模式: 玩家手动选择行动
    - 自动战斗模式: 系统自动选择最优行动(普通攻击或技能,根据怪物抗性和灵气值判断)
    - 挂机战斗模式: 自动选择怪物→进入战斗→自动战斗→战斗结束后自动选择下一个怪物继续战斗,直到体力或气血归零
  - 敌人回合: AI根据妖兽特性自动选择行动
  - 伤害计算系统:
    - 普通攻击伤害(物理系):
      - 计算伤害 = (攻击力 - 防御力×0.5) × (1 - 物理抗性)
      - 最终伤害 = 计算伤害 × 暴击伤害率
      - 说明: 普通攻击固定为物理系,始终受物理抗性影响,不受元素抗性影响
    - 技能伤害(根据技能元素类型):
      - 计算伤害 = (技能基础伤害 + 攻击力×技能倍率) × (1 - 对应元素抗性)
      - 最终伤害 = 计算伤害 × 暴击伤害率
      - 物理系技能: 受物理抗性影响
      - 冰系技能: 受冰系抗性影响
      - 火系技能: 受火系抗性影响
      - 雷系技能: 受雷系抗性影响
    - 抗性上限: 玩家75%(通过装备叠加),怪物50%(每种)
  - 暴击系统:
    - 暴击率 = 基础5% + 武器暴击率(最高15%) + 项链暴击率(最高10%)
    - 暴击伤害率: 未暴击100%(原始伤害),暴击200%(双倍伤害)
    - 暴击率可叠加(武器+项链最高可达30%)
  - 结算奖励: 战斗胜利后结算经验值、掉落物品和战利品
  - 战斗结果: 胜利获得奖励和经验,失败扣除灵气或受伤,逃跑成功则结束战斗但无奖励
  - 挂机战斗自动停止条件: 体力归零、气血归零、玩家主动停止
- **FR-018**: 系统必须提供背包系统,存储灵草、矿石、丹药、装备、材料
- **FR-019**: 系统必须实现炼丹系统,包含:
  - 炼丹能力等级系统(1-10级:初级→宗师):
    - 等级与品阶关系:
      - 1-2级: 只能炼制1-2阶丹药
      - 3-4级: 可炼制1-4阶丹药
      - 5-6级: 可炼制1-6阶丹药
      - 7-8级: 可炼制1-8阶丹药
      - 9-10级: 可炼制1-10阶丹药(包括仙丹)
    - 等级与成功率加成: 每级增加5%成功率加成,10级宗师+50%成功率
    - 熟练度升级:
      - 每次炼丹获得经验值=丹药品阶×10×品质系数
      - 品质系数: 下品(1.0)/中品(1.5)/上品(2.0)/极品(3.0)
      - 失败也获得50%经验
      - 升级所需经验递增: 100, 300, 600, 1000, 1500, 2100, 2800, 3600, 4500
  - 炼丹机制:
    - 成功率=基础成功率+境界加成+悟性加成+丹炉品质加成+炼丹等级加成
    - 品质判定: 下品(60%)/中品(30%)/上品(8%)/极品(2%)
    - 消耗: 消耗材料、灵力、时间
- **FR-020**: 系统必须实现丹药效果,服用后产生对应增益(回气、加速修炼、突破加成等),丹药效果有持续时间或一次性消耗
- **FR-021**: 系统必须实现炼器系统,包含:
  - 炼器能力等级系统(1-10级:学徒→铸器大师):
    - 等级与品质关系:
      - 1-2级: 只能炼制普通品质
      - 3-4级: 可炼制普通、稀有品质
      - 5-6级: 可炼制普通、稀有、史诗品质
      - 7-8级: 可炼制普通、稀有、史诗、传说品质
      - 9-10级: 可炼制所有品质(包括仙品)
    - 等级与成功率加成: 每级增加4%成功率加成,10级大师+40%成功率
    - 等级与属性加成: 每级增加装备基础属性2%,10级大师制作的装备属性+20%
    - 熟练度升级:
      - 每次炼器获得经验值=品质基础值×强化等级系数
      - 品质基础值: 普通(10)/稀有(30)/史诗(60)/传说(100)/仙品(200)
      - 失败也获得50%经验
      - 升级所需经验递增: 150, 400, 800, 1300, 2000, 2800, 3700, 4700, 6000
  - 炼器机制:
    - 成功率=基础成功率+境界加成+悟性加成+炉品质加成+炼器等级加成
    - 装备随机属性生成(受炼器等级影响)
    - 强化系统: 成功率随等级递减
    - 失败可能掉级
- **FR-022**: 系统必须实现装备系统,允许玩家装备法器,装备后提升战斗力或修炼效率
- **FR-023**: 系统必须实现技能系统,包含:
  - 技能分类:
    - 按功能分类: 攻击/防御/辅助/治疗
    - 按元素分类(攻击技能):
      - 物理系: 无视元素抗性,受物理抗性影响
      - 冰系: 冰霜伤害,受冰系抗性影响,可能附加减速效果
      - 火系: 火焰伤害,受火系抗性影响,可能附加持续灼烧
      - 雷系: 雷电伤害,受雷系抗性影响,可能附加麻痹效果
  - 技能伤害计算公式:
    - 计算伤害 = (技能基础伤害 + 攻击力 × 技能倍率) × (1 - 对应属性的抗性)
    - 最终伤害 = 计算伤害 × 暴击伤害率
    - 技能输出计算(所有元素技能统一公式):
      - 物理技能输出 = 技能基础伤害 + 攻击力 × 技能倍率
      - 冰系技能输出 = 技能基础伤害 + 攻击力 × 技能倍率
      - 火系技能输出 = 技能基础伤害 + 攻击力 × 技能倍率
      - 雷系技能输出 = 技能基础伤害 + 攻击力 × 技能倍率
    - 抗性计算:
      - 物理抗性 = 所有装备的物理抗性之和(上限75%)
      - 冰系抗性 = 所有装备的冰系抗性之和(上限75%)
      - 火系抗性 = 所有装备的火系抗性之和(上限75%)
      - 雷系抗性 = 所有装备的雷系抗性之和(上限75%)
    - 暴击伤害率: 未暴击100%(原始伤害),暴击200%(双倍伤害)
    - 暴击率: 基础5% + 武器暴击率(最高15%) + 项链暴击率(最高10%)
  - 技能机制:
    - 学习途径:
      - 宗门学习: 通过宗门贡献度兑换学习(不同宗门有不同特色技能)
      - 商店购买: 使用灵石购买通用技能
      - 任务奖励: 完成宗门任务或探索事件获得
      - 传承获得: 探索奇遇中获得上古传承技能
    - 学习条件: 境界要求、灵石/贡献度消耗、职位要求(宗门技能)
    - 技能等级和升级: 每级提升技能倍率
    - 战斗中只能使用已装备的技能
  - 技能装备系统:
    - 技能装备槽位:
      - 攻击技能槽: 4个(可装备4个攻击技能)
      - 辅助技能槽: 2个(可装备2个辅助技能,包括防御/治疗技能)
    - 装备规则:
      - 必须先学习技能,才能装备
      - 只有已装备的技能才能在战斗中使用
      - 可以随时更换已装备的技能(在非战斗状态)
    - 装备/卸载功能:
      - 装备技能: 从已学技能中选择,装备到对应槽位
      - 卸载技能: 将已装备技能从槽位中移除
      - 替换技能: 直接选择新技能替换已装备的技能
  - 玩家可学习功法解锁技能,技能在战斗和修炼中使用,消耗灵气产生额外效果
- **FR-024**: 系统必须实现技能熟练度机制,使用技能提升熟练度,技能升级后效果增强或消耗降低
- **FR-025**: 系统必须实现装备管理功能,包含:
  - 装备类型分类:
    - 武器(1个槽位): 攻击力、暴击率(最高15%)、速度等属性
    - 防具(5个槽位): 头盔、铠甲、护手、护腿、靴子各1个槽位,提供防御力、生命值、物理抗性、冰系抗性、火系抗性、雷系抗性等
    - 饰品(3个槽位): 戒指2个槽位、项链1个槽位
      - 项链属性: 生命值、攻击力、防御力、暴击率(最高10%)、元素抗性等
      - 戒指属性: 生命值、攻击力、防御力、元素抗性等
  - 总计装备槽位: 9个(武器×1、头盔×1、铠甲×1、护手×1、护腿×1、靴子×1、戒指×2、项链×1)
  - 抗性系统: 单件装备最高+15%抗性,可通过多件装备叠加,总抗性上限75%
  - 暴击率系统: 武器最高提供15%暴击率,项链最高提供10%暴击率
  - 装备品质: 普通、稀有、史诗、传说、仙品
  - 随机属性范围: 根据装备品质和类型生成随机属性
  - 强化等级: 0-15级,强化提升装备属性
  - 支持装备、卸下、替换装备,显示装备属性对比
- **FR-026**: 系统必须实现装备强化功能,消耗材料强化装备提升属性,强化有失败概率和风险
- **FR-027**: 系统必须实现宝石镶嵌功能,装备有孔可镶嵌宝石,宝石提供额外属性,可拆卸
- **FR-028**: 系统必须实现元素抗性系统,装备可附带物理抗性、冰系抗性、火系抗性、雷系抗性,单件装备最高+15%抗性,多件装备可叠加,总抗性上限75%
- **FR-029**: 系统必须实现装备评分机制,包含:
  - 评分范围: 0-10000分
  - 评分计算公式: 评分=品质基础分+主属性总和×属性系数+抗性总和×抗性系数+强化等级×强化系数+特殊效果加分
  - 品质基础分: 普通100分、稀有300分、史诗600分、传说1000分、仙品2000分
  - 属性系数: 每点主属性(攻击/防御/生命)贡献2分
  - 抗性系数: 每1%抗性贡献3分(抗性更稀有,权重更高)
  - 强化系数: 每级强化贡献50分
  - 特殊效果: 每个特效+100分
  - 评分显示: 装备详情中显示评分,方便玩家判断装备价值
- **FR-030**: 系统必须实现一键售卖功能,包含:
  - 评分阈值设置: 玩家可设置售卖阈值(如:售卖500分以下装备)
  - 批量售卖流程:
    1. 扫描背包中所有装备
    2. 筛选出评分低于阈值且未装备的装备
    3. 显示售卖列表和总收益预览
    4. 确认后批量售卖,获得灵石
  - 售卖价格计算: 售价 = 评分 × 品质系数
    - 普通品质: 评分 × 1
    - 稀有品质: 评分 × 2
    - 史诗品质: 评分 × 4
    - 传说品质: 评分 × 8
    - 仙品品质: 评分 × 15
  - 售卖列表显示: 显示每件装备的名称、品质、评分、售卖价格
  - 总收益预览: 显示所有选中装备的总售卖价格(灵石)
  - 确认机制: 显示售卖列表和总收益,玩家确认后才执行售卖
- **FR-031**: 系统必须实现售卖安全保护,已装备的装备不会被选中售卖,避免误操作
- **FR-032**: 系统必须实现宗门系统,包含:
  - 宗门列表: 青云剑宗、丹霞谷、天机阁、无极魔宗、万兽山庄
  - 职位体系: 宗主/长老/内门弟子/外门弟子
  - 宗门任务: 获得贡献度和奖励
  - 贡献度兑换: 使用贡献度兑换宗门技能、装备、丹药
  - 每个宗门有特色和加入要求
- **FR-033**: 系统必须实现宗门任务系统,宗门成员可完成任务获得宗门贡献和声望
- **FR-034**: 系统必须实现宗门商店和宗门技能学习系统,包含:
  - 宗门商店: 玩家可用宗门贡献兑换稀有功法、丹药、材料
  - 宗门技能学习系统:
    - 职位权限:
      - 外门弟子: 可学习基础技能(1-2阶技能)
      - 内门弟子: 可学习进阶技能(1-4阶技能)
      - 长老: 可学习高级技能(1-6阶技能)
      - 宗主: 可学习所有宗门技能(1-8阶技能)
    - 不同宗门特色技能:
      - 青云剑宗: 剑法系技能(物理系攻击为主)
      - 丹霞谷: 炼丹辅助技能(治疗、增益类技能)
      - 天机阁: 法术系技能(元素攻击为主)
      - 无极魔宗: 魔功技能(高伤害、有副作用)
      - 万兽山庄: 驯兽技能(召唤、辅助类)
    - 学习条件:
      - 必须加入宗门
      - 达到对应职位等级
      - 消耗贡献度学习技能
      - 满足境界要求
    - 技能获取方式:
      - 宗门技能库: 通过贡献度兑换学习
      - 宗门任务奖励: 完成任务获得技能
      - 职位晋升奖励: 晋升时获得特定技能
- **FR-035**: 系统必须实现宗门战功能,宗门之间可进行对战,参与者获得奖励
- **FR-036**: 系统必须实现境界体系,包含13个大境界(凡人→炼气期1-9层→筑基期1-9层→结丹期1-9层→元婴期1-9层→化神期1-9层→炼虚期1-9层→合体期1-9层→大乘期1-9层→真仙境1-9层→金仙境1-9层→太乙境1-9层→大罗境1-9层→道祖之境)
- **FR-037**: 系统必须实现经验值升级机制,境界1-8层通过积累经验值自动升级,无需突破
- **FR-038**: 系统必须实现境界突破机制,境界9层通过积累经验值并满足突破条件(灵气满、心境达标、特殊机缘)后可突破下一大境界
- **FR-039**: 系统必须实现机缘事件系统,提供突破瓶颈的特殊机会
- **FR-040**: 系统必须实现数据持久化,使用MySQL数据库存储游戏数据:
  - 自动存档: 定时自动保存游戏进度(每30-60秒),在关键节点(境界突破、获得重要物品)时额外立即保存
  - 数据存储: 所有角色数据、背包物品、装备、功法、技能、宗门信息等持久化到MySQL数据库
  - 数据完整性: 确保数据事务一致性,避免存档损坏或数据丢失
  - 存档读取: 游戏启动时从MySQL数据库加载角色数据
  - 多角色支持: 支持创建多个角色,每个角色独立存储
- **FR-041**: 系统必须提供游戏结束判定(飞升成功、兵解重修、寿元耗尽、达到道祖之境)

### Non-Functional Requirements

- **NFR-001**: 系统性能要求:所有用户操作(修炼、探索、炼丹、炼器、战斗、技能、打坐、突破、查看状态)的反馈必须在3秒内显示,确保流畅的用户体验
- **NFR-002**: 可扩展性:系统支持小规模部署,最多支持10个并发用户,为未来扩展预留空间
- **NFR-003**: 数据持久化可靠性:定时自动保存游戏进度(每30-60秒),在关键节点(境界突破、获得重要物品)时额外立即保存,确保数据不丢失
- **NFR-004**: 数据完整性和备份:使用MySQL数据库事务确保数据一致性,避免存档损坏或数据丢失,仅依赖事务机制无额外备份
- **NFR-005**: 可用性:系统支持多角色管理,每个角色独立存储,游戏启动时从数据库加载角色数据
- **NFR-006**: 可观测性:系统必须记录关键操作日志,包含境界突破(成功/失败)、炼丹结果(成功/失败/品质)、炼器结果(成功/失败/品质)、战斗胜负(胜利/失败/逃跑)、重要物品获取(高品质装备、稀有技能、传说物品)
- **NFR-007**: 安全性和输入验证:系统必须对所有用户输入进行基本格式验证,角色姓名验证长度限制(2-6个字符),菜单选择验证有效性,防止无效输入导致系统异常

### Key Entities

- **角色(玩家)**: 包含姓名、境界、境界层次、经验值、升级所需经验、可用加点点数、灵气值、灵气上限、体力、体力上限、气血值、气血上限、心境、五维属性(体质、精神、悟性、机缘、气运)、背包、功法、技能、装备栏、宗门、当前状态
- **五维属性**:
  - **体质**: 决定体力最大值和气血最大值,体质越高体力越充足、血量越厚
  - **精神**: 决定最大灵力值,精神越高灵力上限越高、法术威力越大
  - **悟性**: 决定获取经验值的速度,悟性越高每次修炼获得的经验值越多
  - **机缘**: 决定打怪装备掉落率,机缘越高击败妖兽后装备掉落概率越大、掉落品质越高
  - **气运**: 决定攻击暴击率和战斗速度(速度=基础值+气运×系数),气运越高暴击概率和伤害倍数越高,战斗中先手概率越大
- **境界**: 定义修炼阶段,包含13个大境界(凡人、炼气期、筑基期、结丹期、元婴期、化神期、炼虚期、合体期、大乘期、真仙境、金仙境、太乙境、大罗境、道祖之境),每个大境界分9层(除凡人和仙级境界)
- **境界突破**: 定义从一层升级到九层所需经验值,以及从九层突破到下一大境界的条件和成功率计算:
  - 突破条件: 经验值充足、灵气满、心境达标
  - 突破成功率计算: (基础成功率+丹药加成)×机缘系数
    - 基础成功率: 根据境界差异(如炼气→筑基50%,筑基→结丹40%,结丹→元婴30%等)
    - 丹药加成: 突破丹+20%,高级突破丹+30%
    - 机缘系数: 机缘1时1.0,机缘10时1.5,最高不超过2.0
- **物品**: 包含类型(灵草、矿石、丹药、装备、材料、宝石)、名称、效果、数量、品质
- **丹方**: 定义炼丹配方(所需灵草、炼制时间、基础成功率、成品丹药效果、成品数量范围、丹药品阶)
- **炼丹能力等级**: 定义玩家炼丹技能等级(1-10级:初级→宗师),包含:
  - 等级与品阶关系: 1-2级可炼制1-2阶丹药,3-4级可炼制1-4阶,5-6级可炼制1-6阶,7-8级可炼制1-8阶,9-10级可炼制1-10阶(包括仙丹)
  - 等级与成功率加成: 每级增加5%成功率加成(10级宗师+50%成功率)
  - 熟练度升级: 每次炼丹获得经验值=丹药品阶×10×品质系数(下品1.0/中品1.5/上品2.0/极品3.0),失败获得50%经验,升级所需经验递增(100, 300, 600, 1000, 1500, 2100, 2800, 3600, 4500)
- **炼丹机制**: 成功率=基础成功率+境界加成+悟性加成+丹炉品质加成+炼丹等级加成,品质判定:下品(60%)/中品(30%)/上品(8%)/极品(2%)
- **炼器能力等级**: 定义玩家炼器技能等级(1-10级:学徒→铸器大师),包含:
  - 等级与品质关系: 1-2级只能炼制普通品质,3-4级可炼制普通/稀有,5-6级可炼制普通/稀有/史诗,7-8级可炼制普通/稀有/史诗/传说,9-10级可炼制所有品质(包括仙品)
  - 等级与成功率加成: 每级增加4%成功率加成(10级大师+40%成功率)
  - 等级与属性加成: 每级增加装备基础属性2%(10级大师+20%属性)
  - 熟练度升级: 每次炼器获得经验值=品质基础值×强化等级系数(普通10/稀有30/史诗60/传说100/仙品200),失败获得50%经验,升级所需经验递增(150, 400, 800, 1300, 2000, 2800, 3700, 4700, 6000)
- **炼器机制**: 成功率=基础成功率+境界加成+悟性加成+炉品质加成+炼器等级加成,装备随机属性生成(受炼器等级影响),强化系统(成功率随等级递减,失败可能掉级)
- **器方**: 定义炼器配方(所需矿石和材料、炼制时间、基础成功率、成品品质范围、成品属性加成)
- **功法**: 包含名称、境界要求、修炼加成、解锁技能、学习条件(悟性、机缘)
- **技能**: 包含名称、技能分类(功能分类、元素分类)、效果、灵气消耗、熟练度、升级条件、技能倍率、附加效果:
  - **功能分类**: 攻击/防御/辅助/治疗
  - **元素分类**(攻击技能):
    - 物理系: 无视元素抗性,受物理抗性影响,无附加效果
    - 冰系: 冰霜伤害,受冰系抗性影响,附加减速效果(敌人下回合速度降低)
    - 火系: 火焰伤害,受火系抗性影响,附加持续灼烧效果(敌人每回合受到持续伤害)
    - 雷系: 雷电伤害,受雷系抗性影响,附加麻痹效果(敌人下回合无法行动)
  - **技能伤害计算公式**:
    - 计算伤害 = (技能基础伤害 + 攻击力 × 技能倍率) × (1 - 对应属性的抗性)
    - 最终伤害 = 计算伤害 × 暴击伤害率
    - 技能输出计算(所有元素技能统一公式):
      - 物理技能输出 = 技能基础伤害 + 攻击力 × 技能倍率
      - 冰系技能输出 = 技能基础伤害 + 攻击力 × 技能倍率
      - 火系技能输出 = 技能基础伤害 + 攻击力 × 技能倍率
      - 雷系技能输出 = 技能基础伤害 + 攻击力 × 技能倍率
    - 抗性计算:
      - 物理抗性 = 所有装备的物理抗性之和(上限75%)
      - 冰系抗性 = 所有装备的冰系抗性之和(上限75%)
      - 火系抗性 = 所有装备的火系抗性之和(上限75%)
      - 雷系抗性 = 所有装备的雷系抗性之和(上限75%)
    - 暴击伤害率: 未暴击100%(原始伤害),暴击200%(双倍伤害)
    - 暴击率: 基础5% + 武器暴击率(最高15%) + 项链暴击率(最高10%)
  - **技能机制**:
    - 学习途径:
      - 宗门学习: 通过宗门贡献度兑换学习(不同宗门有不同特色技能)
      - 商店购买: 使用灵石购买通用技能
      - 任务奖励: 完成宗门任务或探索事件获得
      - 传承获得: 探索奇遇中获得上古传承技能
    - 学习条件: 境界要求、灵石/贡献度消耗、职位要求(宗门技能)
    - 技能等级和升级: 每级提升技能倍率
    - 战斗中只能使用已装备的技能
  - **技能装备系统**:
    - 技能装备槽位: 攻击技能槽4个、辅助技能槽2个(包括防御/治疗技能)
    - 装备规则: 必须先学习技能才能装备,只有已装备的技能才能在战斗中使用,可以随时更换已装备的技能(在非战斗状态)
    - 装备功能: 从已学技能中选择装备到对应槽位
    - 卸载功能: 将已装备技能从槽位中移除
    - 替换功能: 直接选择新技能替换已装备的技能
- **妖兽**: 包含名称、境界、类型(普通/精英/BOSS)、速度(决定行动顺序)、生命力、攻击力、防御力、攻击元素类型(物理/冰/火/雷)、元素抗性(最多2种,每种0%-50%)、战斗力、掉落物品、出现概率、AI行为模式、体力消耗(普通10点、精英20点、BOSS 30点)
  - **示例妖兽类型**:
    - **火焰蜥蜴**(精英火系妖兽): 火系攻击,火系抗性50%、物理抗性20%,体力消耗20点
    - **冰霜狼**(精英冰系妖兽): 冰系攻击,冰系抗性40%、雷系抗性10%,体力消耗20点
    - **普通野狼**(普通物理妖兽): 物理攻击,无特殊抗性,体力消耗10点
- **探索事件类型**: 定义探索系统中的随机事件类型,包含:
  - TREASURE(宝藏): 洞府遗迹、宝箱,奖励包含装备、材料、灵石
  - DANGER(危险): 强盗袭击、陷阱,需要战斗或消耗资源解除,胜利获得战利品
  - ENCOUNTER(奇遇): 高人指点、行脚商人,奖励包含永久属性提升、临时增益、交易机会
  - INHERITANCE(传承): 上古传承,奖励包含功法、技能、永久属性提升,额外消耗10体力(领悟消耗)
  - 事件触发率受气运属性影响(气运越高,触发有利事件概率越高)
- **机缘事件**: 包含事件类型、触发条件、奖励内容、发生概率
- **宗门**: 包含名称、宗门特色、加入要求(境界、属性)、宗门任务、宗门商店、宗门成员、职位体系、宗门技能学习系统:
  - **宗门列表**:
    - 青云剑宗: 剑法系技能(物理系攻击为主)
    - 丹霞谷: 炼丹辅助技能(治疗、增益类技能)
    - 天机阁: 法术系技能(元素攻击为主)
    - 无极魔宗: 魔功技能(高伤害、有副作用)
    - 万兽山庄: 驯兽技能(召唤、辅助类)
  - **职位体系**: 宗主/长老/内门弟子/外门弟子
  - **宗门技能学习系统**:
    - 职位权限:
      - 外门弟子: 可学习基础技能(1-2阶技能)
      - 内门弟子: 可学习进阶技能(1-4阶技能)
      - 长老: 可学习高级技能(1-6阶技能)
      - 宗主: 可学习所有宗门技能(1-8阶技能)
    - 不同宗门特色技能:
      - 青云剑宗: 剑法系技能(物理系攻击为主)
      - 丹霞谷: 炼丹辅助技能(治疗、增益类技能)
      - 天机阁: 法术系技能(元素攻击为主)
      - 无极魔宗: 魔功技能(高伤害、有副作用)
      - 万兽山庄: 驯兽技能(召唤、辅助类)
    - 学习条件:
      - 必须加入宗门
      - 达到对应职位等级
      - 消耗贡献度学习技能
      - 满足境界要求
    - 技能获取方式:
      - 宗门技能库: 通过贡献度兑换学习
      - 宗门任务奖励: 完成任务获得技能
      - 职位晋升奖励: 晋升时获得特定技能
- **宗门任务**: 包含任务类型(击杀妖兽/采集灵草/炼丹炼器)、任务奖励(贡献、声望、物品、技能)
- **装备**: 包含名称、装备类型分类、品质、基础属性、随机属性、强化等级(0-15级)、镶嵌宝石、元素抗性、装备评分(0-10000分)、装备槽位:
  - **装备类型分类**:
    - 武器(1个槽位): 攻击力、暴击率(最高15%)、速度等属性
    - 防具(5个槽位): 头盔、铠甲、护手、护腿、靴子各1个槽位,提供防御力、生命值、物理抗性、冰系抗性、火系抗性、雷系抗性等
    - 饰品(3个槽位): 戒指2个槽位、项链1个槽位
      - 项链属性: 生命值、攻击力、防御力、暴击率(最高10%)、元素抗性等
      - 戒指属性: 生命值、攻击力、防御力、元素抗性等
  - **装备品质**: 普通、稀有、史诗、传说、仙品,品质越高基础属性和随机属性范围越大
  - **随机属性范围**: 根据装备品质和类型生成随机属性,传说和仙品装备具有更多随机属性
  - **强化等级**: 0-15级,强化提升装备基础属性,强化等级越高属性提升越多
  - **抗性系统**: 元素抗性(物理/冰系/火系/雷系),单件装备最高+15%抗性,多件装备可叠加,总抗性上限75%
  - **暴击率系统**: 武器最高提供15%暴击率,项链最高提供10%暴击率
  - **装备评分计算**:
    - 评分范围: 0-10000分
    - 评分公式: 评分=品质基础分+主属性总和×属性系数+抗性总和×抗性系数+强化等级×强化系数+特殊效果加分
    - 品质基础分: 普通100分、稀有300分、史诗600分、传说1000分、仙品2000分
    - 属性系数: 每点主属性(攻击/防御/生命)贡献2分
    - 抗性系数: 每1%抗性贡献3分(抗性更稀有,权重更高)
    - 强化系数: 每级强化贡献50分
    - 特殊效果: 每个特效+100分
    - 评分显示: 装备详情中显示评分,方便玩家判断装备价值
- **装备栏**: 玩家共有9个装备位(武器×1、头盔×1、手套×1、铠甲×1、护腿×1、靴子×1、戒指×2、项链×1),戒指可装备2件,其余各装备1件

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 玩家可以在5分钟内完成角色创建并开始修炼
- **SC-002**: 玩家可以清晰理解当前目标和下一步操作(通过界面文字提示)
- **SC-003**: 玩家从凡人到练气期的完整流程可以在30分钟内完成
- **SC-004**: 每个操作(修炼、探索、炼丹、炼器、战斗、技能)的反馈在3秒内显示
- **SC-005**: 80%的玩家可以独立完成从凡人到筑基期的过程(无需查阅攻略)
- **SC-006**: 游戏提供至少9种不同的玩法组合(修炼、探索、战斗、炼丹、炼器、技能、装备强化、宗门、机缘)供玩家选择
- **SC-007**: 玩家可以通过至少10种不同方式获取修炼资源(探索采集、战斗掉落、炼丹转化、炼器强化、交易、机缘、秘境、任务、宗门奖励、宗门战)
- **SC-008**: 游戏难度曲线合理,境界突破成功率在30%-70%之间,避免过于简单或过于困难
- **SC-009**: 玩家可以学习至少5种不同的功法,每个功法解锁2-3个技能,提供多样化玩法
- **SC-010**: 装备系统提供9个装备部位(武器、头盔、手套、铠甲、护腿、靴子、戒指×2、项链),每个部位可强化+10并镶嵌宝石,支持元素抗性系统(物理/冰系/火系/雷系),单件装备最高+15%抗性,总抗性上限75%
- **SC-011**: 宗门系统提供至少3个不同特色的宗门供玩家选择,每个宗门有独特的功法和奖励
- **SC-012**: 游戏包含13个大境界(炼气→筑基→结丹→元婴→化神→炼虚→合体→大乘→真仙→金仙→太乙→大罗→道祖),提供长期修炼目标
- **SC-013**: 每个大境界包含9个小层次(除仙级境界),通过积累经验值升级,境界1-8层自动升级,9层需突破
- **SC-014**: 经验值获取途径多样化(修炼、战斗、任务、宗门、机缘事件等),玩家可自主选择升级路线

## Out of Scope

为了确保MVP版本的聚焦和可交付性,以下功能明确排除在本规范范围之外:

### 排除的核心功能

- **多人在线功能**: 不包含实时多人交互、玩家间交易、公会战、组队副本等需要服务器间实时通信的功能
- **图形界面**: 纯文字界面,不包含2D/3D图形渲染、动画效果、视觉特效
- **实时战斗**: 采用回合制战斗,不包含动作类实时战斗、即时战斗操作
- **付费功能**: 不包含内购、付费道具、订阅制、广告变现等商业化功能
- **移动端支持**: MVP版本仅支持桌面端(浏览器访问),不包含原生移动应用(iOS/Android)
- **社交网络功能**: 不包含好友系统、聊天、社交分享、排行榜等社交功能
- **跨服功能**: 不包含跨服务器数据迁移、跨服战、多服务器管理

### 排除的技术功能

- **高级安全功能**: 不包含防作弊系统、加密通信、复杂的权限管理
- **数据分析功能**: 不包含用户行为分析、A/B测试、数据可视化仪表板
- **国际化支持**: 不包含多语言支持,仅支持简体中文
- **离线模式**: 需要保持网络连接访问服务器,不包含离线游玩功能
- **数据导出功能**: 不包含用户数据导出API、数据备份下载功能

### 未来版本可能包含的功能

以下功能可能在MVP之后的版本中考虑,但不包含在当前规范中:
- 多人在线功能和玩家交互
- 图形界面增强(如简单的ASCII艺术升级)
- 更复杂的社交系统(好友、聊天、组队)
- 商业化模式设计
- 移动端原生应用
- 跨服功能和数据迁移

## Assumptions

基于修仙题材的常见设定和文字游戏的特点,做出以下假设:

1. **游戏目标**: 玩家的核心目标是提升境界、从凡人修炼到道祖之境
2. **体力系统**: 初始体力100点,上限可通过体质属性提升,战斗(普通10点/精英20点/BOSS 30点)、炼丹、炼器、探索消耗体力,体力为0时只能打坐或休息
3. **修炼和突破系统**: 修炼基础经验=境界基础值×悟性系数,突破成功率=(基础成功率+丹药加成)×机缘系数,境界越高突破难度越大(基础成功率越低)
4. **战斗系统**: 采用回合制战斗,包含速度判定(由气运决定)、玩家行动选择、AI决策、奖励结算四个步骤,妖兽元素系统(物理/冰/火/雷),伤害计算公式,暴击系统(基础5%+武器最高15%+项链最高10%),妖兽属性系统(每个妖兽有攻击元素类型和最多2种元素抗性,如火焰蜥蜴为火系攻击/火抗50%/物抗20%,冰霜狼为冰系攻击/冰抗40%/雷抗10%)
5. **装备系统**: 9个装备位(武器、头盔、手套、铠甲、护腿、靴子、戒指×2、项链),支持元素抗性(物理/冰系/火系/雷系),单件最高+15%,总抗性上限75%,装备评分0-10000分,武器和项链提供暴击率加成
6. **数据持久化**: 使用MySQL数据库存储所有游戏数据,支持自动存档、多角色管理、数据事务一致性
7. **游戏时长**: 单次游戏体验时长预计数十小时到数百小时(完整体验13个大境界)
8. **难度设计**: 境界1-8层通过经验值自动升级,9层需突破且有失败概率,提供重试和替代路径
9. **文字交互**: 采用命令式菜单选择(如"1.修炼 2.探索 3.炼丹"),而非自然语言输入
10. **数值平衡**: 基于"付出→回报"原则,修炼时间越长、资源越多,经验值获取越多,突破成功率越高
11. **境界体系**: 采用完整修仙设定(炼气期1-9层→筑基期1-9层→结丹期1-9层→元婴期1-9层→化神期1-9层→炼虚期1-9层→合体期1-9层→大乘期1-9层→真仙境→金仙境→太乙境→大罗境→道祖之境)
12. **升级机制**: 境界1-8层自动升级(经验值达标),9层需要主动突破(经验值+灵气满+心境+机缘)
13. **机缘系统**: 随机事件提供不确定性,增加游戏重玩价值,可提供突破所需特殊机缘
14. **社交功能**: MVP版本不包含多人在线功能,仅单人体验
15. **画面表现**: 纯文字界面,通过ASCII艺术或简单排版增强视觉体验
16. **技术栈**: 使用Java + Spring Boot + MyBatis-Plus作为后端技术栈,MySQL数据库持久化,支持10个并发用户,满足3秒响应时间要求
17. **数据量和存储**: 单个角色数据量估计小于100KB(包含角色属性、背包物品、装备、技能、宗门信息等),对于10个并发用户总数据量小于1MB,数据库存储压力很小
18. **部署环境**: MVP版本部署在本地开发环境(开发者电脑上运行),适合单人开发或小团队,无需云端部署或容器化配置

## Clarifications

### Session 2026-01-13

- Q: 关于数据自动保存频率,您希望如何处理? → A: 定时自动保存(每30秒或60秒),在关键节点(境界突破、获得重要物品)时额外立即保存
- Q: 系统响应时间的性能目标是什么? → A: 快速响应(所有操作在3秒内完成)
- Q: 预期的并发用户规模是多少? → A: 小规模(支持最多10个并发用户)
- Q: 系统需要记录哪些日志信息? → A: 仅关键操作日志(境界突破、炼丹炼器结果、战斗胜负、重要物品获取)
- Q: 数据备份和灾难恢复策略是什么? → A: 仅依赖MySQL事务保证数据完整性,无额外备份机制
- Q: 技术栈选择的约束是什么? → A: Java + Spring Boot + MyBatis-Plus
- Q: 输入验证和安全策略是什么? → A: 基本验证(仅验证数据格式,如姓名长度2-6字符)
- Q: 单个角色的数据量估计是多少? → A: 小于100KB(包含角色、背包、装备、技能、宗门等)
- Q: 需要在规范中明确排除哪些功能(Out of Scope)? → A: 添加Out of Scope章节,明确排除多人在线、图形界面、实时战斗、付费功能等非MVP功能
- Q: 预期的部署环境是什么? → A: 本地开发环境(开发者电脑上运行)
